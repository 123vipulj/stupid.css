$(function(){var confirm_delete='Are you sure you want to delete this object?';var date_format='%m/%d/%Y';var datetime_format='%Y-%m-%d %H:%M:%S';var regex_integer=/[^0-9\-]|\-(?=.)/g;var regex_number=/[^0-9\-\.,]|[\-](?=.)|[\.,](?=[0-9]*[\.,])/g;var doc=$(document);var undef=function(x){return typeof x==='undefined';};var remove=function(elem,c){if(elem.hasClass(c))elem.removeClass(c);};if(!String.prototype.reverse){String.prototype.reverse=function(){return this.split('').reverse().join('');};}
doc.on('click','.close',function(){var t=$(this).parent();if(t.css('top')=='0px')t.slideUp('slow');else t.fadeOut();});doc.on('keyup','input.integer',function(){var nvalue=this.value.reverse().replace(regex_integer,'').reverse();if(this.value!=nvalue)this.value=nvalue;});doc.on('keyup','input.number',function(){var nvalue=this.value.reverse().replace(regex_number,'').reverse();if(this.value!=nvalue)this.value=nvalue;});doc.on('click','input[type="checkbox"].delete',function(){if(this.checked&&!confirm(confirm_delete))
this.checked=false;});doc.on('keyup','input[data-range]',function(){var t=$(this);var v=t.val();var range=t.attr('data-range').split(',');if(t.is('.integer')||t.is('.number')){console.log(v);v=parseFloat(v);range=[range[0]||parseFloat(range[0]),range[1]||parseFloat(range[1])];}
if(undef(v)||((range[0]!='')&&v<range[0])||((range[1]!='')&&v>range[1]))
t.addClass('error');else remove(t,'error');});doc.on('keyup','input[data-regex]',function(){var t=$(this);var v=t.val();var re=new RegExp(t.attr('data-regex'));if(!v.match(re))t.addClass('error');else remove(t,'error');});});
$.fn.calendar=function(){if(this.length>1)
return this.each(function(){$(this).calendar();});var swap=function(x){var w=$('<input/>').addClass(x.attr('class')).attr('style',x.attr('style'));x.hide().after(w);return w;};var ISO='{yyyy}-{MM}-{dd} {hh}:{mm}:{ss}';var self=this;var input=swap(self);var popup=$('<table class="cal-wrapper"/>');var value=self.val();var date=Date.create(value);var start=input.data('start')||'Sunday';var format=input.data('format')||'{dd}/{MM}/{year} {hh}:{mm} {TT}';var format_time=format;if(format_time.indexOf('{year}')>=0)
format_time=format_time.split(' ')[1];var timeout=null;var set=function(){self.val(input.val().trim().length&&date&&date.format(ISO)||'').change();};var update=(function(){date=Date.create(input.val());redraw(true);}).debounce(100);var func=function(dt){return function(e){e.stopPropagation();date=Date.create(q);if(dt['minutes'])
date.set({seconds:0,minutes:5*parseInt(date.getMinutes()/5)});date.advance(dt);redraw()};};var tr=function(x){return'<tr>'+x+'</tr>';}
var td=function(x,c,d){return'<td'+(c&&(' class="cal-'+c+'"')||'')+(d&&(' colspan="'+d+'"')||'')+'>'+(x||'')+'</td>';}
var q=date;var redraw=function(mute){console.log(date);if(!mute)input.val(date.format(format));if(input.is('.error'))input.removeClass('error');if(input.val().trim()==''){set();q=Date.create();}else if(date&&date!='Invalid Date'){set();q=Date.create(date);}else{input.addClass('error');q=Date.create();}
var row='',k=0,html='';var day=Date.create(q).set({day:1});while(!day.is(start))day.advance({days:-1});var next=Date.create(q).advance({months:1}).set({days:7});while(!day.is(start))next.advance({days:-1});if(format.indexOf('{year}')>=0){html+=tr(td('&laquo;','ym')+td('&lsaquo;','mm')+
td(q.format('{Mon} {year}'),'y',3)+
td('&rsaquo;','mp')+td('&raquo;','yp'));var tds=[0,1,2,3,4,5,6].map(function(n){return td((n).daysAfter(start).format('{Dow}'));});html+=tr(tds.join(''));while(day.isBefore(next)){if(k%7==0)row='';if(day.is(q))row+=td(day.format('{d}'),'selected');else if(day.getMonth()==q.getMonth())row+=td(day.format('{d}'),'day');else row+=td('');day.advance({days:1});k++;if(k%7==0)html+=tr(row);}}
if(format.indexOf('{hh}')>=0){html+=tr(td('&laquo;','Hm')+td('&lsaquo;','mim')+
td(q.format(format_time),'t',3)+
td('&rsaquo;','mip')+td('&raquo;','Hp'));}
popup.html(html).find('td').css({'text-align':'center'});popup.find('.cal-ym').click(func({years:-1}));popup.find('.cal-yp').click(func({years:+1}));popup.find('.cal-mm').click(func({months:-1}));popup.find('.cal-mp').click(func({months:+1}));popup.find('.cal-Hm').click(func({hours:-1}));popup.find('.cal-Hp').click(func({hours:+1}));popup.find('.cal-mim').click(func({minutes:-5}));popup.find('.cal-mip').click(func({minutes:+5}));popup.find('.cal-day').click(function(e){e.stopPropagation();date=q;var d=parseInt($(this).text());date.set({day:d});redraw();});popup.find('.cal-y,.cal-t,.cal-selected').css('font-weight','bold');$('.cal-wrapper').not(popup).hide();popup.fadeIn();}
var close=function(e){var q=$(e.target);if(q.is('input')||q.closest('.cal-wrapper').length>0)return;set();if(timeout)clearTimeout(timeout);timeout=setTimeout(function(){if(popup.find('td:hover').length==0)popup.fadeOut();},300);};input.keyup(update).blur(close).click(function(e){e.stopPropagation();redraw();});$('html').on('click',close);popup.click(function(e){e.stopPropagation();});popup.css({'position':'absolute','z-index':3000,'top':(input.offset().top+input.height()+10)+'px','left':(input.offset().left)+'px','cursor':'pointer','background':'white','box-shadow':'0 0 12px #ddd'});input.val(date.format(format)).after(popup);set();};$(function(){$('.date,.datetime,.time').calendar();});
$.fn.slider=function(){if(this.length>1)
return this.each(function(){$(this).slider();});var t=this;var s=$('<div/>');var range=t.attr('data-range').split(',');var decimals=range[1]&&range[1].split('.')[1];decimals=decimals&&decimals.length||0;range=range.map(parseFloat);s.css({position:'absolute','z-index':1,top:(t.offset().top+t.outerHeight()-5)+'px',left:t.offset().left+'px',height:5+'px','pointer-events':'none',background:'rgba(0,0,0,0.2)'});var left=parseInt(t.css('padding-left').replace('px',''));var right=parseInt(t.css('padding-right').replace('px',''));var update=(function(e){var shift=e.offsetX;var percent=Math.max(0,Math.min(1.0,shift/(t.outerWidth())));var value=range[0]+percent*(range[1]-range[0]);if(range[2])value=range[2]*Math.round(value/range[2]);if(t.is('.integer'))value=parseInt(value);else value=Math.round(value,decimals);t.val(value).change();s.css({width:shift+'px'});}).throttle(10);var onchange=function(){if(t.val())width=(t.outerWidth())*Math.max(0,Math.min(1,parseFloat(t.val())/(range[1]-range[0])));else width=0;s.css({width:width});}
onchange();t.keyup(onchange);t.dblclick(update);t.after(s);var isDragging=false;t.mousedown(function(){isDragging=true;});t.mousemove(function(e){if(isDragging)update(e);});t.mouseup(function(){isDragging=false;});$(window).resize(function(){s.css({top:t.offset().top+'px',left:t.offset().left+'px'});});};$(function(){$('.slider').slider();});
$.fn.stars=function(){if(this.length>1)
return this.each(function(){$(this).stars();});var span=$('<span class="stars-wrapper" style="white-space:nowrap"><span data-value="1">&#x2606;</span><span data-value="2">&#x2606;</span><span data-value="3">&#x2606;</span><span data-value="4">&#x2606;</span><span data-value="5">&#x2606;</span></span>');var self=$(this).hide().after(span);span.css('padding-left',self.css('padding-left'));var fill_stars=function(){var k=parseInt(self.val())||0;for(var i=1;i<6;i++)
span.find('[data-value='+i+']').html((i<=k)?'&#x2605;':'&#x2606;');};for(var k=0;k<6;k++)(function(k){span.find('[data-value='+k+']').mouseover(function(){for(var i=1;i<6;i++)
span.find('[data-value='+i+']').html((i<=k)?'&#x2605;':'&#x2606;');}).click(function(){self.val(k).change();fill_stars();});})(k);span.mouseout(fill_stars);fill_stars();};$(function(){$('input.stars').stars();});
$.fn.tags=function(){if(this.length>1)
return this.each(function(){$(this).tags();});var swap=function(x){var w=$('<input/>').addClass(x.attr('class')).attr('style',x.attr('style'));x.hide().after(w);return w;};var self=this;var sep=self.attr('data-separator')||',';;var tags=self.val().split(sep);var options=self.attr('data-options');var container=$('<div class="tags dismissible"/>');var input=swap(this);options=options&&options.split(sep)||[];container.css('padding-left',self.css('padding-left'));self.after(container);var tag=function(name){return $('<span>'+name+'</span>').attr('data-tag-name',name);};var show=function(){container.html('');for(var i=0;i<tags.length;i++)
container.append(tag(tags[i])).append(' ');for(var i=0;i<options.length;i++)
if(tags.indexOf(options[i])<0)
container.append(tag(options[i]).addClass('off')).append(' ');self.val(tags.join(sep)).change();};input.keyup(function(e){e.preventDefault();var code=e.keyCode||e.which;if(code==13||code==188){var k=input.val().trim().replace(/(^[,;:-]+|[,;:-]+$)/,'');if(k&&tags.indexOf(k)<0){container.append(tag(k)).append(' ');tags.push(k);show();}
input.val('');};});container.on('click','span:not(.off)',function(){var p=$(this);var name=p.attr('data-tag-name');tags.splice(tags.indexOf(name),1);if(options.indexOf(name)<0)options.unshift(name);show();p.remove();});container.on('click','span.off',function(){var p=$(this);tags.push(p.attr('data-tag-name'));show();p.remove();});show();};$(function(){$('input.tags').tags();});
