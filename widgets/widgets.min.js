jQuery(function(){var confirm_delete='Are you sure you want to delete this object?';var date_format='%m/%d/%Y';var datetime_format='%Y-%m-%d %H:%M:%S';var regex_integer=/[^0-9\-]|\-(?=.)/g;var regex_number=/[^0-9\-\.,]|[\-](?=.)|[\.,](?=[0-9]*[\.,])/g;var doc=$(document);var undef=function(x){return typeof x==='undefined';};var remove=function(elem,c){if(elem.hasClass(c))elem.removeClass(c);};if(!String.prototype.reverse){String.prototype.reverse=function(){return this.split('').reverse().join('');};}
doc.on('click','.close',function(){var t=$(this).parent();if(t.css('top')=='0px')t.slideUp('slow');else t.fadeOut();});doc.on('keyup','input.integer',function(){var nvalue=this.value.reverse().replace(regex_integer,'').reverse();if(this.value!=nvalue)this.value=nvalue;});doc.on('keyup','input.number',function(){var nvalue=this.value.reverse().replace(regex_number,'').reverse();if(this.value!=nvalue)this.value=nvalue;});doc.on('click','input[type="checkbox"].delete',function(){if(this.checked&&!confirm(confirm_delete))
this.checked=false;});doc.on('keyup','input[data-range]',function(){var t=jQuery(this);var v=t.val();var range=t.attr('data-range').split(',');if(t.is('.integer')||t.is('.number')){console.log(v);v=parseFloat(v);range=[range[0]||parseFloat(range[0]),range[1]||parseFloat(range[1])];}
if(undef(v)||((range[0]!='')&&v<range[0])||((range[1]!='')&&v>range[1]))
t.addClass('error');else remove(t,'error');});doc.on('keyup','input[data-regex]',function(){var t=jQuery(this);var v=t.val();var re=new RegExp(t.attr('data-regex'));if(!v.match(re))t.addClass('error');else remove(t,'error');});});
$.fn.calendar=function(){if(this.length>1)
return this.each(function(){jQuery(this).calendar();});var ISO='{yyyy}-{MM}-{dd} {hh}:{mm}:{ss}';var t=this;var s=jQuery('<input type="hidden"/>');var w=jQuery('<table class="cal-wrapper"/>');var value=t.val();var date=Date.create(value);var start=t.data('start')||'Sunday';var format=t.data('format')||'{dd}/{MM}/{year} {hh}:{mm} {TT}';var format_time=format;if(format_time.indexOf('{year}')>=0)
format_time=format_time.split(' ')[1];var timeout=null;var set=function(){s.val(t.val().trim().length&&date&&date.format(ISO)||'');};var update=(function(){date=Date.create(t.val());redraw(true);}).debounce(100);var func=function(dt){return function(event){date=Date.create(q).advance(dt);redraw()};};var tr=function(x){return'<tr>'+x+'</tr>';}
var td=function(x,c,d){return'<td'+(c&&(' class="cal-'+c+'"')||'')+(d&&(' colspan="'+d+'"')||'')+'>'+(x||'')+'</td>';}
var q=date;var redraw=function(mute){if(!mute)t.val(date.format(format));if(t.is('.error'))t.removeClass('error');if(t.val().trim()==''){set();q=Date.create();}else if(date&&date!='Invalid Date'){set();q=Date.create(date);}else{t.addClass('error');q=Date.create();}
var row='',k=0,html='';var day=Date.create(q).set({day:1});while(!day.is(start))day.advance({days:-1});var next=Date.create(q).advance({months:1}).set({days:7});while(!day.is(start))next.advance({days:-1});if(format.indexOf('{year}')>=0){html+=tr(td('&laquo;','ym')+td('&lsaquo;','mm')+
td(q.format('{Mon} {year}'),'y',3)+
td('&rsaquo;','mp')+td('&raquo;','yp'));var tds=[0,1,2,3,4,5,6].map(function(n){return td((n).daysAfter(start).format('{Dow}'));});html+=tr(tds.join(''));while(day.isBefore(next)){if(k%7==0)row='';if(day.is(q))row+=td(day.format('{d}'),'selected');else if(day.getMonth()==q.getMonth())row+=td(day.format('{d}'),'day');else row+=td('');day.advance({days:1});k++;if(k%7==0)html+=tr(row);}}
if(format.indexOf('{hh}')>=0){html+=tr(td('&laquo;','Hm')+td('&lsaquo;','mim')+
td(q.format(format_time),'t',3)+
td('&rsaquo;','mip')+td('&raquo;','Hp'));}
w.html(html).find('td').css({'text-align':'center'});w.find('.cal-ym').click(func({years:-1}));w.find('.cal-yp').click(func({years:+1}));w.find('.cal-mm').click(func({months:-1}));w.find('.cal-mp').click(func({months:+1}));w.find('.cal-Hm').click(func({hours:-1}));w.find('.cal-Hp').click(func({hours:+1}));w.find('.cal-mim').click(func({minutes:-5}));w.find('.cal-mip').click(func({minutes:+5}));w.find('.cal-day').click(function(){date=q;var d=parseInt(jQuery(this).text());date.set({day:d});redraw();});w.find('.cal-y,.cal-t,.cal-selected').css('font-weight','bold');jQuery('.cal-wrapper').not(w).hide();w.fadeIn();}
var close=function(){set();if(timeout)clearTimeout(timeout);timeout=setTimeout(function(){if(!jQuery('.cal-wrapper:hover').is(w))w.fadeOut();},300);};t.removeAttr('name').after(s.prop('name',t.prop('name')));t.keyup(update).blur(close).click(redraw);w.mouseout(close);w.css({'position':'absolute','z-index':3000,'top':(t.offset().top+t.height()+10)+'px','left':(t.offset().left)+'px','background':'white','box-shadow':'0 0 12px #ddd'});t.val(date.format(format)).after(w);set();};jQuery(function(){jQuery('.date,.datetime,.time').calendar();});
$.fn.slider=function(){var t=this;var s=jQuery('<div/>');var range=t.attr('data-range').split(',');var decimals=range[1]&&range[1].split('.')[1];decimals=decimals&&decimals.length||0;range=range.map(parseFloat);s.css({position:'absolute','z-index':1,top:t.offset().top+'px',left:t.offset().left+'px',height:t.outerHeight()+'px','pointer-events':'none',background:'rgba(0,0,0,0.2)'});var left=parseInt(t.css('padding-left').replace('px',''));var right=parseInt(t.css('padding-right').replace('px',''));var update=(function(e){var shift=e.offsetX-t.offset().left+left+right;var percent=Math.max(0,Math.min(1.0,shift/(t.outerWidth())));var value=range[0]+percent*(range[1]-range[0]);if(range[2])value=range[2]*Math.round(value/range[2]);if(t.is('.integer'))value=parseInt(value);else value=Math.round(value,decimals);t.val(value);s.css({width:shift+'px'});}).throttle(10);var onchange=function(){if(t.val())width=(t.outerWidth())*Math.max(0,Math.min(1,parseFloat(t.val())/(range[1]-range[0])));else width=0;s.css({width:width});}
onchange();t.keyup(onchange);t.dblclick(update);t.after(s);var isDragging=false;t.mousedown(function(){isDragging=true;});t.mousemove(function(e){if(isDragging)update(e);});t.mouseup(function(){isDragging=false;});};jQuery(function(){jQuery('.slider').slider();});
